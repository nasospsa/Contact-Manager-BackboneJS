define(["views/contact","models/contact"],function(e,t){var n=Backbone.View.extend({initialize:function(){this.render(),this.contacts=this.collection.initial(),this.$el.find("#filter").append(this.createSelect()),this.on("change:filterType",this.filterByType,this),this.collection.on("reset",this.render,this),this.collection.on("add",this.renderContact,this),this.collection.on("remove",this.removeContact,this)},render:function(){this.$el.find("article").remove(),this.collection.each(function(e){this.renderContact(e)},this)},renderContact:function(t){var n=new e({model:t,collection:this.collection,router:this.options.router,directoryView:this});this.$el.append(n.render().el)},getTypes:function(){return _.uniq(this.collection.pluck("type"),!1,function(e){return e.toLowerCase()})},createSelect:function(){var e=this.$el.find("#filter"),t=$("<select/>",{html:"<option value='all'>All</option>"});return _.each(this.getTypes(),function(e){var n=$("<option/>",{value:e.toLowerCase(),text:e.toLowerCase()}).appendTo(t)}),t},events:{"change #filter select":"setFilter","submit #addContact":"addContact","click #showForm":"showForm"},setFilter:function(e){this.filterType=e.currentTarget.value,this.trigger("change:filterType")},filterByType:function(){if(this.filterType==="all")this.collection.reset(this.contacts),this.options.router.navigate("filter/all");else{var e=this.filterType,t=_.filter(this.contacts,function(t){return t.get("type").toLowerCase()===e});this.collection.reset(t),this.options.router.navigate("filter/"+e)}},showForm:function(){this.$el.find("#addContact").slideToggle()},addContact:function(e){e.preventDefault();var n={};$("#addContact",this.$el).children("input").each(function(e,t){$(t).val()!==""&&(n[t.id]=$(t).val(),$(t).val(""))}),this.$el.find("#addContact").slideToggle(),this.contacts.push(new t.Model(n)),_.indexOf(this.getTypes(),n.type)===-1?(this.collection.add(new t.Model(n)),this.$el.find("#filter").find("select").remove().end().append(this.createSelect())):this.collection.add(new t.Model(n))},removeContact:function(e){var t=e.attributes;t.photo==="/img/placeholder.png"&&delete t.photo,contacts=this.contacts,_.each(contacts,function(e){_.isEqual(e,t)&&contacts.splice(_.indexOf(contacts,e),1)}),this.contacts=contacts}});return n})